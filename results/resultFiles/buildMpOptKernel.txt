
 scriptFileName: scripts/mp/buildMpOptKernel.txt
   logFileName: results/runLogs/buildMpOptKernel.txt
resultFileName: results/resultFiles/buildMpOptKernel.txt
outputFileName: 
reboot

RESET: 0 0 ?    0 ?

RESET: 1 0 ?    0 ?

RESET: 2 0 ?    0 ?

RESET: 3 0 ?    0 ?

RESET: 4 0 ?    0 ?

RESET: 5 0 ?    0 ?

RESET: 6 0 ?    0 ?
Prop0 Cog6 ok
cr c" here: " .cstr here W@ . (version) .cstr cr cr

here: 17320 devKERNEL6.0-2015Sep12 19:41-0

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
1 wconstant forthmakerfence
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
' forthmakerfence pfa>nfa wconstant asmsearchstart
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ ixnfa ( n1 -- c-addr ) returns the n1 from the last nfa address
Prop0 Cog6 ok

Prop0 Cog6 ok
: ixnfa

 0 max wlastnfa W@

 begin

  over 0=

  if

   -1

  else

   swap 1- swap nfa>next dup 0=

  then

 until

 nip

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ nfacount ( -- n1 ) returns the number of nfas in the forth dictionary
Prop0 Cog6 ok

Prop0 Cog6 ok
: nfacount

 0 wlastnfa W@

 begin

  swap 1+ swap nfa>next dup 0=

 until

 drop

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ nfaix ( c-addr -- n1 ) returns the index of the nfa address, -1 if not found
Prop0 Cog6 ok

Prop0 Cog6 ok
: nfaix

 -1 swap 0 wlastnfa W@

 begin

  rot 2dup =

  if

   2drop swap -1 -1 -1

  else

   rot 1+ rot nfa>next dup 0=

  then

 until

 3drop

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ lastdef ( c-addr -- t/f ) true if this is the most recently defined word 
Prop0 Cog6 ok

Prop0 Cog6 ok
: lastdef

 lastnfa over _dictsearch dup

 if

  =

 else

  2drop -1

 then

; 
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable lastNewNFA
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable initialNewhere
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable newhere
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable currentWordSize
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable savebase
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: nh+  dup newhere W+! negate currentWordSize W+! ;
Prop0 Cog6 ok

Prop0 Cog6 ok
: nh2+ 2 nh+ ;
Prop0 Cog6 ok

Prop0 Cog6 ok
: dolalign+

 newhere W@ 3 and

 if

  ." w h_0 " nh2+

  2 currentWordSize W+!

 then

;
Prop0 Cog6 ok

Prop0 Cog6 ok
: dolalign

 newhere W@ 3 and

 if

  ." w h_0 " nh2+

 then

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ asmlookup ( n1 --- n2) n1 the assembler address, n2 0 if not found, symbol nfa
Prop0 Cog6 ok

Prop0 Cog6 ok
: asmlookup

 0 swap asmsearchstart

 begin

 \ ( -1 n1 nfa)

  dup c" $C_" npfx

  if

   2dup nfa>pfa 2+ W@ =

   if

    rot2 -1

   else

     nfa>next dup 0=

   then

  else

   nfa>next dup 0=

  then  

 until

 2drop

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ isExecasm ( addr -- t/f) true if addr is one of the ifuncs
Prop0 Cog6 ok

Prop0 Cog6 ok
: isExecasm

 dup $C_a__xasm2>1 =

 over $C_a__xasm2>flag = or

 over $C_a__xasm1>1 = or

 swap $C_a__xasm2>0 = or

;
Prop0 Cog6 ok

Prop0 Cog6 ok
 
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ isExecasmIMM ( addr -- t/f) true if addr is one of the immediate ifuncs
Prop0 Cog6 ok

Prop0 Cog6 ok
: isExecasmIMM

 dup $C_a__xasm2>1IMM =

 swap $C_a__xasm2>flagIMM = or

;
Prop0 Cog6 ok

Prop0 Cog6 ok
 
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
: dcmp1

 2+ dup W@ ." w h_" . nh2+

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
: dcmp2

 2+ alignl

 dup dup W@ dolalign ." w h_" .  2+ W@ ." w h_" .  2+ nh2+ nh2+

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
: dcmp3

  asmlookup dup 0= 

  if

   drop ." * ***h_" .

  else

   ." a " .strname space drop

  then

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ dcmp ( addr -- addr t/f) process the post word data, flag true if at the end of the word
Prop0 Cog6 ok

Prop0 Cog6 ok
: dcmp

 dup W@ dup $C_a_doconw = swap $C_a_dovarw = or

 if

  dcmp1 -1

 else

  

 dup W@ isExecasmIMM

 if

  dcmp1

  dcmp1 0

 else



 dup W@ dup isExecasm

 over $C_a_litw = or

 over $C_a_branch = or

 over $C_a_(loop) = or

 over $C_a_(+loop) = or

 swap $C_a_0branch = or

 if

  dcmp1 0

 else



 dup W@ dup $C_a_doconl =

 swap $C_a_dovarl = or

 if

  dcmp2 -1

 else

 dup W@ $C_a_litl =

 if

  dcmp2 0

 else



 dup W@ dup $H_dq = swap $H_cq = or

 if

  dup 2+ C@ 2+ 2/ 0

  do

   2+ dup W@ ." w h_" . nh2+

  loop

  0

 else



 dup W@ $C_a_lxasm =

 if

  2+

  dup 3 and

  if

   -2 currentWordSize W+!

   alignl

  then

  dolalign+

  dup L@ h9 rshift h1FF and 0

  do

   dup dup W@  ." w h_" . 2+  W@ ." w h_" .  4+ nh2+ nh2+

  loop

  -1

 else

  dup W@ $C_a_exit =

 thens

;
Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok
\ wordforth( addr1 -- addr2 ) addr1 is the nfa, addr2 is the pfa address at the end of this word
Prop0 Cog6 ok

Prop0 Cog6 ok
: wordforth

 nfa>pfa 2-

 begin

  2+ dup W@ dup hFE00 and 0=

  if

  \ ( addr @ -- )

   dup dcmp3

  else

   ." p " pfa>nfa .strname space

  then

  nh2+

  dcmp

 until

 drop

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ fixalign ( ix -- ix)
Prop0 Cog6 ok

Prop0 Cog6 ok
: fixalign

 dup ixnfa nfa>lfa 3 and 0<> 

 if

  newhere W@ 3 and 0=

  if

   \ ." ~h0D\" dup ixnfa dup . .strname space newhere W@ . ." fixalign~h0D" 

   2 newhere W+!

  then

 else

  newhere W@ 3 and 0<>

  if

   \ ." ~h0D\" dup ixnfa dup . .strname space newhere W@ . ." fixalign~h0D" 

   2 newhere W+!

  then

 then

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ doword ( ix -- )
Prop0 Cog6 ok

Prop0 Cog6 ok
: doword

 \ cr newhere W@ . lastNewNFA W@ .

 fixalign

 \ newhere W@ . lastNewNFA W@ . cr

 

\ dup . dup ixnfa dup . .strname space dup 1- ixnfa dup . .strname space



 dup 1- ixnfa over ixnfa - currentWordSize W!

\ currentWordSize W@ . cr

 ." h_"  newhere W@ dup . ." h_" lastNewNFA W@ dup 0<> if 2+ then . lastNewNFA W! nh2+ ixnfa dup C@ h_E0 and ." h_" .

 dup .strname dup C@ namemax and 2+ 1 andn nh+ space

 \ (nfa --)

 dup C@ h80 and 0=

 if

   dup nfa>pfa W@ dcmp3 nh2+

 else

  dup nfa>pfa W@ dup $C_a_doconw =

  if

  \ (nfa pfa@ -- )

   drop ." a $C_a_doconw " nfa>pfa 2+ W@ ." w h_" . nh2+ nh2+

  else dup $C_a_dovarw = if

   2drop ." a $C_a_dovarw w h_0 " nh2+ nh2+

  else dup $C_a_doconl = if

   drop ." a $C_a_doconl " nfa>pfa 2+ alignl L@ nh2+ dolalign+

    ." w h_" dup hFFFF and .  h10 rshift  ." w h_" . nh2+ nh2+

  else dup $C_a_dovarl = if

   2drop ." a $C_a_dovarl " nh2+ dolalign ." w h_0 w h_0 " nh2+ nh2+ 

  else

   drop wordforth

 thens

\ cr currentWordSize W@ . cr

 currentWordSize W@ 0>

 if

  currentWordSize W@ h7FFF >

  if

   ." ******************************************************* " currentWordSize W@ .

  else

   currentWordSize W@ 1+ 2/ 0

   do

    ." w h_0 " nh2+

   loop

  then

 then

 ." e~h0D~h0D" 

;
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable _forthmakerFlag
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable _hi
Prop0 Cog6 ok

Prop0 Cog6 ok
\ forthmaker ( n1 -- ) generates the forth intermediate code, n1 starting address, must be a long
Prop0 Cog6 ok

Prop0 Cog6 ok
: forthmaker

 -1 _forthmakerFlag W!

 base W@ savebase W!

 hex

 dup newhere W! initialNewhere W!

 0 lastNewNFA W!

 c" forthmakerfence" find nip c" forthmakerfenceend" find nip or

 c" forthmakerdeletefence" find nip or

 if

  \ these should always be the first 3 words

  c" _bt" find drop pfa>nfa nfaix doword

  c" _fi" find drop pfa>nfa nfaix doword

  c" _cd" find drop pfa>nfa nfaix doword

  

  c" forthmakerdeletefence" find drop pfa>nfa nfaix nfacount 1- tuck swap - 0

  do

\ dup . i . dup i - . dup i - ixnfa .strname _forthmakerFlag W@ . cr

   _forthmakerFlag W@

   if

    dup i - ixnfa c" forthmakerfence" name=

    if

     0 _forthmakerFlag W!

     0

    else 

     -1

    then

   else

    dup i - ixnfa c" forthmakerfenceend" name=

    if

     -1 _forthmakerFlag W!

     0

    else 

     0

    then     

   then

   

   if

    dup i - dup ixnfa

    

    dup c" _bt" name=

    over c" _fi" name= or

    over c" _cd" name= or

    if

     2drop

    else   

\ 2dup swap . dup . .strname space

     lastdef

\ dup . cr

     if

      doword

     else

      drop

     then

    then

   then

  loop

  drop

 then

 -1 . cr cr



 ." \ initialNewhere h_" initialNewhere W@ . cr cr

 ." \ newhere h_" newhere W@ . cr cr

 ." \ lastNewNFA h_" lastNewNFA W@ . cr cr

 savebase W@ base W!

;
Prop0 Cog6 ok

Prop0 Cog6 ok
1 wconstant forthmakerfenceend
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ 1 wconstant forthmakerdeletefence h18 forthmaker
Prop0 Cog6 ok

Prop0 Cog6 ok
 
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: (version) c" mpOptKERNEL6.0-2015Sep12 19:43-0" ;
Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ Output of assembling OpimizeAsmSrc.f goes above this comment block
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ u* ( u1 u2 -- u1*u2) u1 multiplied by u2
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: u*


 um* drop


;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ u/mod ( u1 u2 -- remainder quotient ) \ unsigned divide & mod  u1 divided by u2
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: u/mod


 0 swap um/mod


;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ u/ ( u1 u2 -- u1/u2) u1 divided by u2
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: u/


 u/mod nip


;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
1 wconstant forthmakerdeletefence
Prop0 Cog6 ok
1 wconstant _xis
Prop0 Cog6 ok
1 wconstant isnumber
Prop0 Cog6 ok
1 wconstant isunumber
Prop0 Cog6 ok
1 wconstant isdigit
Prop0 Cog6 ok
1 wconstant _xnu
Prop0 Cog6 ok
1 wconstant number
Prop0 Cog6 ok
1 wconstant unumber
Prop0 Cog6 ok
1 wconstant todigit
Prop0 Cog6 ok
$C_treg1 wconstant $C_treg1
UNDEFINED WORD $C_treg1
Prop0 Cog6 ok
$C_treg2 wconstant $C_treg2
UNDEFINED WORD $C_treg2
Prop0 Cog6 ok
$C_a_litw1 wconstant $C_a_litw1
UNDEFINED WORD $C_a_litw1
Prop0 Cog6 ok
$C_a_reset wconstant $C_a_reset
UNDEFINED WORD $C_a_reset
Prop0 Cog6 ok
$C_a_stPush wconstant $C_a_stPush
UNDEFINED WORD $C_a_stPush
Prop0 Cog6 ok
$C_a_stPush1 wconstant $C_a_stPush1
UNDEFINED WORD $C_a_stPush1
Prop0 Cog6 ok
$C_a_stPush_ret wconstant $C_a_stPush_ret
UNDEFINED WORD $C_a_stPush_ret
Prop0 Cog6 ok
$C_a_rsPush wconstant $C_a_rsPush
UNDEFINED WORD $C_a_rsPush
Prop0 Cog6 ok
$C_a_rsPush1 wconstant $C_a_rsPush1
UNDEFINED WORD $C_a_rsPush1
Prop0 Cog6 ok
$C_a_rsPush_ret wconstant $C_a_rsPush_ret
UNDEFINED WORD $C_a_rsPush_ret
Prop0 Cog6 ok
$C_a_stpopC_treg wconstant $C_a_stpopC_treg
UNDEFINED WORD $C_a_stpopC_treg
Prop0 Cog6 ok
$C_a_stPop wconstant $C_a_stPop
UNDEFINED WORD $C_a_stPop
Prop0 Cog6 ok
$C_a_stPop1 wconstant $C_a_stPop1
UNDEFINED WORD $C_a_stPop1
Prop0 Cog6 ok
$C_a_stPop_ret wconstant $C_a_stPop_ret
UNDEFINED WORD $C_a_stPop_ret
Prop0 Cog6 ok
$C_a_stpopC_treg_ret wconstant $C_a_stpopC_treg_ret
UNDEFINED WORD $C_a_stpopC_treg_ret
Prop0 Cog6 ok
$C_a_rsPop wconstant $C_a_rsPop
UNDEFINED WORD $C_a_rsPop
Prop0 Cog6 ok
$C_a_rsPop1 wconstant $C_a_rsPop1
UNDEFINED WORD $C_a_rsPop1
Prop0 Cog6 ok
$C_a_rsPop_ret wconstant $C_a_rsPop_ret
UNDEFINED WORD $C_a_rsPop_ret
Prop0 Cog6 ok
$C_fDestInc wconstant $C_fDestInc
UNDEFINED WORD $C_fDestInc
Prop0 Cog6 ok
$C_fCondMask wconstant $C_fCondMask
UNDEFINED WORD $C_fCondMask
Prop0 Cog6 ok
$C_fAddrMask wconstant $C_fAddrMask
UNDEFINED WORD $C_fAddrMask
Prop0 Cog6 ok
$C_fLongMask wconstant $C_fLongMask
UNDEFINED WORD $C_fLongMask
Prop0 Cog6 ok
$C_stPtr wconstant $C_stPtr
Prop0 Cog6 ok
$C_rsPtr wconstant $C_rsPtr
Prop0 Cog6 ok
$C_stTOS wconstant $C_stTOS
UNDEFINED WORD $C_stTOS
Prop0 Cog6 ok
$C_cogdata wconstant $C_cogdata
UNDEFINED WORD $C_cogdata
Prop0 Cog6 ok
$C_treg3 wconstant $C_treg3
UNDEFINED WORD $C_treg3
Prop0 Cog6 ok
$C_treg4 wconstant $C_treg4
UNDEFINED WORD $C_treg4
Prop0 Cog6 ok
$C_treg5 wconstant $C_treg5
UNDEFINED WORD $C_treg5
Prop0 Cog6 ok
$C_treg6 wconstant $C_treg6
UNDEFINED WORD $C_treg6
Prop0 Cog6 ok
$C_stBot wconstant $C_stBot
UNDEFINED WORD $C_stBot
Prop0 Cog6 ok
$C_stTop wconstant $C_stTop
Prop0 Cog6 ok
$C_rsBot wconstant $C_rsBot
UNDEFINED WORD $C_rsBot
Prop0 Cog6 ok
$C_rsTop wconstant $C_rsTop
Prop0 Cog6 ok
$V_state wconstant $V_state
UNDEFINED WORD $V_state
Prop0 Cog6 ok
$V_numchan wconstant $V_numchan
UNDEFINED WORD $V_numchan
Prop0 Cog6 ok
$V_>in wconstant $V_>in
UNDEFINED WORD $V_>in
Prop0 Cog6 ok
$V_>out wconstant $V_>out
UNDEFINED WORD $V_>out
Prop0 Cog6 ok
$V_coghere wconstant $V_coghere
UNDEFINED WORD $V_coghere
Prop0 Cog6 ok
$V_execword wconstant $V_execword
UNDEFINED WORD $V_execword
Prop0 Cog6 ok
$V_base wconstant $V_base
UNDEFINED WORD $V_base
Prop0 Cog6 ok
$V_cds wconstant $V_cds
UNDEFINED WORD $V_cds
Prop0 Cog6 ok
$V_errdata wconstant $V_errdata
UNDEFINED WORD $V_errdata
Prop0 Cog6 ok
$V_ios wconstant $V_ios
UNDEFINED WORD $V_ios
Prop0 Cog6 ok
$V_numpad wconstant $V_numpad
UNDEFINED WORD $V_numpad
Prop0 Cog6 ok
$V_tbuf wconstant $V_tbuf
UNDEFINED WORD $V_tbuf
Prop0 Cog6 ok
$V_t1 wconstant $V_t1
UNDEFINED WORD $V_t1
Prop0 Cog6 ok
$V_t0 wconstant $V_t0
UNDEFINED WORD $V_t0
Prop0 Cog6 ok
$V_lc wconstant $V_lc
UNDEFINED WORD $V_lc
Prop0 Cog6 ok
$V_pad wconstant $V_pad
UNDEFINED WORD $V_pad
Prop0 Cog6 ok
hA state orC!

 scriptFileName: scripts/mp/buildMpOptKernel.txt
   logFileName: results/runLogs/buildMpOptKernel.txt
resultFileName: results/resultFiles/buildMpOptKernel.txt
outputFileName: results/outputFiles/mpOptKernel.if

 scriptFileName: scripts/mp/buildMpOptKernel.txt
   logFileName: results/runLogs/buildMpOptKernel.txt
resultFileName: results/resultFiles/buildMpOptKernel.txt
outputFileName: 

RESET: 0 0 ?    0 ?

RESET: 1 0 ?    0 ?

RESET: 2 0 ?    0 ?

RESET: 3 0 ?    0 ?

RESET: 4 0 ?    0 ?

RESET: 5 0 ?    0 ?

RESET: 6 0 ?    0 ?
Prop0 Cog6 ok
cr c" here: " .cstr here W@ . (version) .cstr cr cr

here: 17320 devKERNEL6.0-2015Sep12 19:41-0

Prop0 Cog6 ok
h7FFF dup dictend W! memend W!
Prop0 Cog6 ok
wvariable lastNewNFA
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable initialNewhere
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable newhere
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable resolveFlag
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable resolveError
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable initialBaseAddr
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable baseAddr
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: bw,

 resolveFlag W@ 0=

 if

  2 allot

 then

 baseAddr W@ W! 2 baseAddr W+! 2 newhere W+!

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok
 
Prop0 Cog6 ok

Prop0 Cog6 ok
: >tbuf

 tbuf dup C@ + 1+ C!

 tbuf C@ 1+ tbuf C!

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ getword ( -- ) 
Prop0 Cog6 ok

Prop0 Cog6 ok
: getword

 0 tbuf C!

 begin

  key dup bl = over h0D = or

  if

   drop 0

  else

   >tbuf -1

  then

 until

 begin

  key dup bl = over h0D = or

  if

   drop -1

  else

   >tbuf 0

  then

 until

\ ." getword " tbuf .cstr cr

 h2E emit

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ getnumber ( -- 0 | -1) 
Prop0 Cog6 ok

Prop0 Cog6 ok
: getnumber

  getword tbuf C@++ fisnumber 0=

  if

   ." ~h0D* ***ERROR EXPECTED NUMBER: " tbuf .cstr cr cr -1

  else

   tbuf C@++ fnumber 0

  then

\ ." getnumber " over . dup . cr

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: na initialBaseAddr W@ + initialNewhere W@ - ; 
Prop0 Cog6 ok

Prop0 Cog6 ok
: oa initialBaseAddr W@ - initialNewhere W@ + ; 
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ newDictFind ( cstr -- 0 | xt -1 ) c-addr is a counted string, 0 - not found, -1 pfa
Prop0 Cog6 ok

Prop0 Cog6 ok
: newDictFind

 dup tbuf ccopy

 lastNewNFA W@ 0= resolveFlag W@ 0= or

 if

  drop 0

 else

  lastNewNFA W@

  \ 2-

  begin

   dup 0=

   if

    -1

   else

    \ 2+

\    dup . dup na .strname cr

    2dup na name=

    if

     -1

    else

     2- na W@ dup 0=

    then

   then

  until

  2dup na name=

  if

   nip na nfa>pfa oa -1

  else

   2drop 0

   resolveFlag W@

   if

    ." ~h0D~h0D~h0DSymbol not found: " tbuf .cstr cr cr cr

    -1 resolveError W!

   then

  then

 then

\ st?

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ newDictWConst ( cstr -- 0 | xt -1 ) c-addr is a counted string, 0 - not found, -1 const
Prop0 Cog6 ok

Prop0 Cog6 ok
: newDictWConst

 newDictFind dup

 if

  swap na 2+ W@ swap

 then

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ _getfword ( -- 0 | -1 )
Prop0 Cog6 ok

Prop0 Cog6 ok
: _getfword

 begin

  getword

  tbuf c" ;" cstr=

  if

   -1

  else

   tbuf c" a" cstr=

   if

    getword

    tbuf newDictWConst 0=

    if

     0

    then

    bw, resolveError W@

   else

    tbuf c" p" cstr=

    if

     getword

     tbuf newDictFind 0=

     if

      0

     then

     bw, resolveError W@

    else

     tbuf c" w" cstr=

     if

      getnumber

      if

       ." ~h0D* ***ERROR expected number: " tbuf .cstr cr cr -1

      else

       bw, 0

      then

     else

      tbuf c" e" cstr=

      if

       -1

      else

       ." ~h0D* ***ERROR [ a | p | w | e]:" tbuf .cstr cr cr -1

      then

     then

    then

   then

  then

 until

 ; 
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ getfword ( -- 0 | -1 )
Prop0 Cog6 ok

Prop0 Cog6 ok
: getfword

 getnumber over -1 = or

 if

  drop -1

 else

  initialNewhere W@ h_FFFF =

  if

   dup initialNewhere W! dup newhere W!

  then

  \ tolerate long alignment alignment 

  dup newhere W@ <> over newhere W@ 2+ <> and

  if

   ." ~h0D* ***ERROR SYNCH ERROR: " dup . newhere W@ . tbuf .cstr cr cr -1

  else

   newhere W@ 2+ =

   if

    0 bw,

   then



   getnumber

   if

    ." ~h0D* ***ERROR expected lfa: " tbuf .cstr cr cr -1

   else

   

    

    bw,

    getnumber

    if

     ." ~h0D* ***ERROR expected flags: " tbuf .cstr cr cr -1

    else

     getword tbuf baseAddr W@ ccopy

     resolveFlag W@ 0=

     if

      newhere W@ lastNewNFA W!

     then

     baseAddr W@ orC!

     tbuf C@ 2+ 1 andn dup resolveFlag W@ 0= if dup  allot then baseAddr W+! newhere W+!

     _getfword

     0

    then

   then

  then

 then

;
Prop0 Cog6 ok

Prop0 Cog6 ok
 
Prop0 Cog6 ok

Prop0 Cog6 ok
: forthbuilder

 lockdict

 base W@ hex 

 herelal

 here W@ dup baseAddr W! initialBaseAddr W!

 h_0 lastNewNFA W!

 h_0 resolveFlag W!

 h_0 resolveError W!

 h_FFFF initialNewhere W!

 begin

  getfword

  newhere W@ . cr

 until

 cr

 ." \ initialNewhere h_" initialNewhere W@ . cr cr

 ." \ newhere h_" newhere W@ . cr cr

 ." \ lastNewNFA h_" lastNewNFA W@ . cr cr

 base W!

 freedict

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: forthbuilderpass2

 lockdict

 base W@ hex

 initialBaseAddr W@ baseAddr W! 

 -1 resolveFlag W!

 h_0 resolveError W!

 h_FFFF initialNewhere W!

 begin

  getfword

  newhere W@ . cr

 until

 cr

 ." \ initialNewhere h_" initialNewhere W@ . cr cr

 ." \ newhere h_" newhere W@ . cr cr

 ." \ lastNewNFA h_" lastNewNFA W@ . cr cr

 base W!

 freedict

;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
\ _fbPatch ( startCog -- )
Prop0 Cog6 ok

Prop0 Cog6 ok
: _fbPatch

\ the init long for the start cog

 dup c" $S_cdsz" newDictWConst . u*

 c" _cd" newDictFind . 2+ alignl + h10 lshift

 c" _fi" newDictFind . 2+ 2+ 2+ dup . 2 lshift or or

\ third long must be the initialization long

 c" _bt" newDictFind .  2+ 3 4 u* + na L!

\ Patch the forth interpreter 

\  

\

\ Set the initial IP to the forth start word

\

 c" fstart" newDictFind . dup .

 c" _fi" newDictFind . 2+ dup .

 c" $C_IP" newDictWConst . dup . 1+ 4 u* + na dup . L!



 c" $V_lasterr" newDictWConst . dup .

 c" _fi" newDictFind . 2+ dup .

 c" $C_a_lasterr" newDictWConst . dup . 1+ 4 u* + na dup .

 over . dup .

 dup L@ h1FF andn dup . rot dup . or dup . swap dup . L!

\  

\

\ Patch the forth dictionary

\

 dictend W@ dup . c" dictend" newDictFind . na 2+ dup . W!

 memend W@ dup . c" memend" newDictFind . na 2+ dup . W!

 newhere W@ dup . c" here" newDictFind . na 2+ dup . W!

 lastNewNFA dup . W@ c" wlastnfa" newDictFind . na 2+ dup . W!

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable checksum
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable bytecount
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable count0
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable count1
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable count2
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable count3
Prop0 Cog6 ok

Prop0 Cog6 ok
wvariable count4
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: _fbDbg

 hex count0 W@ .

 count1 W@ .

 count2 W@ .

 count3 W@ .

 count4 W@ .

 bytecount W@ .

 checksum W@ .

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
: _fb checksum W+! 1 bytecount W+! ;
Prop0 Cog6 ok

Prop0 Cog6 ok
: fbinout 

 0 checksum W!

 0 bytecount W!

 

 h_00 _fb h_B4 _fb h_C4 _fb h_04 _fb

 h_6F _fb h_00 _fb h_10 _fb h_00 _fb

 h_C0 _fb h_7F _fb h_C8 _fb h_7F _fb

 h_B8 _fb h_7F _fb h_CC _fb h_7F _fb

\ h_B8 _fb h_7F _fb h_D0 _fb h_7F _fb

 h_B0 _fb h_7F _fb h_02 _fb h_00 _fb

 h_A8 _fb h_7F _fb h_00 _fb h_00 _fb

\ h_A8 _fb h_7F _fb h_04 _fb h_00 _fb

 

 bytecount W@ count0 W!

 initialBaseAddr W@ newhere W@ initialNewhere W@ - bounds

 do 

  i C@ _fb

  loop

 bytecount W@ count1 W!

  

 h7FB8 newhere W@ - 0

 do

  0 _fb

  loop

 bytecount W@ count2 W!



 h_35 _fb h_A7 _fb h_14 _fb h_35 _fb

\ h_35 _fb h_C7 _fb h_14 _fb h_35 _fb

 h_2C _fb h_32 _fb h_00 _fb h_00 _fb



 0 _fb 0 _fb 0 _fb h_0 _fb

 0 _fb 0 _fb 0 _fb h_0 _fb

 bytecount W@ count3 W!

 

 h38 0 do

  0 _fb

  loop

 bytecount W@ count4 W!



 h_00 emit h_B4 emit h_C4 emit h_04 emit

 h_6F emit

 h_14 checksum W@ - h_FF and emit

 h_10 emit h_00 emit

 h_C0 emit h_7F emit h_C8 emit h_7F emit

 h_B8 emit h_7F emit h_CC emit h_7F emit

\ h_B8 emit h_7F emit h_D0 emit h_7F emit

 h_B0 emit h_7F emit h_02 emit h_00 emit

 h_A8 emit h_7F emit h_00 emit h_00 emit

\ h_A8 emit h_7F emit h_04 emit h_00 emit

        

 initialBaseAddr W@ newhere W@ initialNewhere W@ - bounds

 do 

  i C@ emit

  loop

  

 h7FB8 newhere W@ - 0

 do

  0 emit

  loop



 h_35 emit h_A7 emit h_14 emit h_35 emit

\ h_35 emit h_C7 emit h_14 emit h_35 emit

 h_2C emit h_32 emit h_00 emit h_00 emit

 h_FF emit h_FF emit h_F9 emit h_FF emit

 h_FF emit h_FF emit h_F9 emit h_FF emit

 

 h38 0 do

  0 emit

  loop

 ;
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
{
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
}
Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok

Prop0 Cog6 ok
forthbuilder
.......................30 
.......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................428 
.......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................B30 
.........B40 
.........B4C 
.........B5A 
...............B6E 
.........B7C 
...............B90 
.........B9C 
.........BAA 
.........BB8 
.........BCA 
.........BD8 
.........BE8 
.........BF8 
.........C06 
.........C1C 
.........C2A 
.........C36 
.........C46 
.........C52 
.........C5E 
.........C68 
.............C76 
.........C7E 
.........C86 
.........C8E 
.........C98 
.........CA2 
.........CAC 
.........CB8 
.........CC4 
...........................CE2 
.......CF6 
.......D06 
.......D16 
.......D24 
.......D32 
.......D40 
.......D4A 
.......D56 
.......D66 
.......D76 
...........D82 
...........D90 
...........D9C 
...........DA8 
...........DB4 
.......DBC 
.......DC4 
.......DCE 
...........DDA 
...........DE6 
...........DF2 
.......DFA 
.......E02 
.......E0C 
.......E18 
...........E28 
...........E38 
.......E44 
.......E50 
.......E5C 
.......E68 
.......E72 
.............E80 
...........E8A 
.......E94 
...........E9E 
.......EA8 
.......EB2 
...........EC2 
...........ECC 
...........ED8 
...........EE4 
...........EEE 
...........EFA 
...........F06 
.............F16 
...........F20 
.........................................F4A 
...........F5A 
.......F62 
.......F6A 
.......F72 
.......F7E 
.......F8A 
.......F96 
.......................FB0 
...........FC0 
...............FD4 
.........................FF2 
.............................1012 
...................................................................105C 
...........106A 
.............107C 
.........108E 
.............109C 
.....................10B4 
.......................10D2 
...........10DE 
.................10F0 
...........................................1120 
...........112E 
.........................................115E 
.............1170 
.................................1198 
.............11AA 
...............................11D2 
...........11E4 
.............11F2 
...........1202 
...............1216 
.........1224 
.........1232 
.............1240 
.............124E 
.............125C 
.............126C 
.............127E 
...............1294 
...............12A8 
.........12BA 
.............12C8 
.............12DA 
.............12EC 
.............12FA 
...............130E 
.............131E 
.............1332 
.............................................1364 
.............1376 
.............1386 
.............1394 
.............13A6 
.............13B6 
...............13CC 
.................13DE 
...................13F8 
...........1406 
...............141C 
...........142A 
...........1438 
...........1446 
.............1454 
...........1460 
.............146E 
.............147C 
.............148A 
.............1498 
.............14A6 
.............14B4 
.............14C2 
.............14D0 
.............14DE 
.............14EC 
.................................1510 
...........151C 
...........152A 
...........1536 
...........1542 
.............1550 
...................1564 
...................157A 
...................1592 
...................15AA 
.............15B8 
...........15C6 
.............................15E8 
.............15FA 
...................1612 
.............1624 
...............1636 
...............................................................167A 
.............168C 
.....................................16B4 
.................16CC 
...............16DE 
.........................................170C 
...................1726 
...........................................................................1776 
...............1788 
.................................17AC 
.............................17D0 
...........17DE 
.....................17F4 
...........17FE 
...........180C 
.........................1828 
.........1836 
.............1848 
...........185A 
...........186A 
.................1884 
.......................18A6 
.....................................................18E4 
.............................................1916 
.........................................1944 
.....................................................................................................................................................19DC 
...................................1A06 
...................................1A30 
.............1A42 
.......................1A5E 
.....................................................................................1AB6 
.............1AC4 
.............................1AE2 
.......................................................1B1E 
...........................1B38 
.................1B4A 
.................1B5C 
.........................1B74 
.............1B84 
...............1B9C 
.......................................................................................................................................1C26 
.............................................................................................1C88 
...............................................................1CCE 
...........1CDC 
...........1CEC 
.........................1D0C 
...................................1D3A 
.......................1D5A 
.............1D6C 
.......................1D88 
.........................1DA6 
...................1DBC 
.......................1DD4 
.....................1DEA 
...........................1E0A 
.........................1E24 
...........1E34 
.............1E4A 
.............1E5E 
.............1E6E 
...............1E80 
.....................................................1EBC 
.......................1ED4 
.......................1EEC 
.....................1F00 
...................................................1F36 
.................................1F56 
...................................................1F8E 
.........1F9A 
...................................................1FD0 
.........................1FEA 
.............................200A 
.....................................2032 
.................2046 
.......................................2072 
...........2080 
...........208E 
.....................20A4 
...............20B6 
.........................20D2 
.............................20F0 
...........................210C 
...........2118 
.........2128 
.........2136 
.............................................................................................................................................................................................................................................222E 
...........2240 
.......................225A 
...........226C 
.......................228A 
...............22A0 
...............22B0 
...............................................................22F2 
.............2300 
.............230C 
.......................................................................................................2374 
.............2380 
.......2386 
...................239A 
.........23A4 
...............23B8 
.................23CE 
.......23D4 
.....................................23F8 
...................240C 
.......................2424 
...............................................2458 
...............................247A 
.........2486 
...............................................................................................................................................................................................................................................................................................25AA 
.............................................................................................................261C 
...............................................264C 
.........................2668 
...................267E 
.......................................................26B6 
.............................................................................................2718 
...........272A 
.............273E 
.............274C 
.......................................................................................................................................................................................................2818 
...................2830 
...........................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................2BD0 
.........2BE0 
...........2BF0 
...........2C06 
...........2C1C 
.........2C30 
.........2C44 
.........2C56 
.........2C64 
.........2C74 
.........2C82 
.........2C98 
.........2CAE 
.........2CC2 
.........2CD2 
...........2CE4 
.........2CF4 
.........2D04 
.........2D16 
.........2D28 
.........2D3A 
.........2D4C 
.........2D5E 
.........2D6E 
.........2D7E 
.........2D8E 
.........2DA0 
.........2DB0 
.........2DC0 
.........2DD0 
.........2DE4 
.........2DF8 
.........2E0C 
.........2E24 
.........2E3C 
.........2E56 
.........2E68 
...........2E76 
.........................................................................2EC0 
...........................................................................2F10 
.............................................................2F50 
.................................................................................2FA4 
...........................................................................................................3018 
.............................................3048 
...............................................................................................................................................................................................310C 
.........................................................................3158 
....
RESET: 6 7814 checkdict    0 ?
Prop0 Cog6 ok
forthbuilderpass2
.......................30 
.......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................428 
.......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................B30 
.........B40 
.........B4C 
.........B5A 
...............B6E 
.........B7C 
...............B90 
.........B9C 
.........BAA 
.........BB8 
.........BCA 
.........BD8 
.........BE8 
.........BF8 
.........C06 
.........C1C 
.........C2A 
.........C36 
.........C46 
.........C52 
.........C5E 
.........C68 
.............C76 
.........C7E 
.........C86 
.........C8E 
.........C98 
.........CA2 
.........CAC 
.........CB8 
.........CC4 
...........................CE2 
.......CF6 
.......D06 
.......D16 
.......D24 
.......D32 
.......D40 
.......D4A 
.......D56 
.......D66 
.......D76 
...........D82 
...........D90 
...........D9C 
...........DA8 
...........DB4 
.......DBC 
.......DC4 
.......DCE 
...........DDA 
...........DE6 
...........DF2 
.......DFA 
.......E02 
.......E0C 
.......E18 
...........E28 
...........E38 
.......E44 
.......E50 
.......E5C 
.......E68 
.......E72 
.............E80 
...........E8A 
.......E94 
...........E9E 
.......EA8 
.......EB2 
...........EC2 
...........ECC 
...........ED8 
...........EE4 
...........EEE 
...........EFA 
...........F06 
.............F16 
...........F20 
.........................................F4A 
...........F5A 
.......F62 
.......F6A 
.......F72 
.......F7E 
.......F8A 
.......F96 
.......................FB0 
...........FC0 
...............FD4 
.........................FF2 
.............................1012 
...................................................................105C 
...........106A 
.............107C 
.........108E 
.............109C 
..............


Symbol not found: u*


10AE 
.
* ***ERROR EXPECTED NUMBER: p

10AE 

\ initialNewhere h_18 

\ newhere h_10AE 

\ lastNewNFA h_315A 

Prop0 Cog10 ok
_cd p + a $C_a_exit e
UNDEFINED WORD p
Prop0 Cog10 ok
hex
Prop0 Cog6 ok
_fbPatch
-1 -1 -1 3C -1 -1 2490 -1 38 -1 2 4EE4 -1 CC -1 38 -1 A1 5160 CC 5160 -7F026A00 CC -7F026934 5160 7FFF -1 59F8 7FFF -1 5A06 10AE -1 59EA 43B8 -1 59DE Prop0 Cog6 ok
hA state orC!

 scriptFileName: scripts/mp/buildMpOptKernel.txt
   logFileName: results/runLogs/buildMpOptKernel.txt
resultFileName: results/resultFiles/buildMpOptKernel.txt
outputFileName: results/outputFiles/mp/mpOptKernel.eeprom

 scriptFileName: scripts/mp/buildMpOptKernel.txt
   logFileName: results/runLogs/buildMpOptKernel.txt
resultFileName: results/resultFiles/buildMpOptKernel.txt
outputFileName: 
Prop0 Cog6 ok
hex count0 W@ .
18 Prop0 Cog6 ok
count1 W@ .
10AE Prop0 Cog6 ok
count2 W@ .
7FB8 Prop0 Cog6 ok
count3 W@ .
7FC8 Prop0 Cog6 ok
count4 W@ .
8000 Prop0 Cog6 ok
bytecount W@ .
8000 Prop0 Cog6 ok
checksum W@ .
294 Prop0 Cog6 ok
